__require=function e(t,a,n){function i(o,c){if(!a[o]){if(!t[o]){var s=o.split("/");if(s=s[s.length-1],!t[s]){var u="function"==typeof __require&&__require;if(!c&&u)return u(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+o+"'")}}var l=a[o]={exports:{}};t[o][0].call(l.exports,function(e){return i(t[o][1][e]||e)},l,l.exports,e,t,a,n)}return a[o].exports}for(var r="function"==typeof __require&&__require,o=0;o<n.length;o++)i(n[o]);return i}({Common:[function(e,t,a){"use strict";cc._RF.push(t,"f2776HHOVZJFZ9C/TrjwOTU","Common"),window.Subdomain=window.Subdomain||{},window.Subdomain.Common={CreateImage:function(e,t){if(e&&t)try{var a=wx.createImage();a.onload=function(){try{var t=new cc.Texture2D;t.initWithElement(a),t.handleLoadedTexture(),e.getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(t)}catch(t){cc.log(t),e.active=!1}},a.src=t}catch(t){cc.log(t),e.active=!1}},SetNodeText:function(e,t){if(e){var a=e.getComponent(cc.Label);a&&(a.string=t)}},SetNodeTexture:function(e,t){if(e){var a=e.getComponent(cc.Sprite);a&&a.spriteFrame.setTexture(cc.url.raw(t))}},GetByteVal:function(e,t){for(var a="",n=0,i=0;i<e.length&&(null!=e[i].match(/[^\x00-\xff]/gi)?n+=2:n+=1,!(n>t));i++)a+=e[i];return a}},cc._RF.pop()},{}],FriendRankList:[function(e,t,a){"use strict";cc._RF.push(t,"44bc3eXHfBEXYshHzJ5PqJO","FriendRankList"),cc.Class({extends:cc.Component,properties:{rankingScrollView:cc.ScrollView,scrollViewContent:cc.Node,prefabRankItem:cc.Prefab},onLoad:function(){cc.director.getWinSize().height/cc.director.getWinSize().width-16/9>.1&&(this.node.scaleY=cc.director.getWinSize().height/1334)},show:function(){this.removeChild(),this.showRankList()},clear:function(){this.removeChild()},removeChild:function(){this.node.removeChildByTag(1e3),this.scrollViewContent.removeAllChildren(),this.rankingScrollView.node.active=!1},showRankList:function(){var e=this;Subdomain.WXHelper.GetFriendCloudData(["highest_score"],function(t){if(t&&t.data){console.log("\u83b7\u53d6\u7528\u6237\u597d\u53cb\u7684\u6258\u7ba1\u6570\u636e:",t),e.dataSort(t.data);for(var a=-1,n=0;n<30&&!(t.data.length<=n);n++){var i=cc.instantiate(e.prefabRankItem,n);i.parent=e.scrollViewContent,i.getComponent("RankItem").initView(n+1,t.data[n]),i.y=-100*n,t.data[n].avatarUrl==Subdomain.UserData.avatarUrl&&(a=n)}var r=e.getSelfData(t.data);if(r){var o=cc.instantiate(e.prefabRankItem,a);o.parent=e.node,o.getComponent("RankItem").initView(a+1,r,!0,-1==a),o.y=-190}e.rankingScrollView.node.active=!0}})},dataSort:function(e){for(var t=0;t<e.length;t++){var a=e[t];a&&a.KVDataList.length<=0&&a.KVDataList.push({key:"highest_score",value:t})}e.sort(function(e,t){var a=parseInt(e.KVDataList[0].value),n=parseInt(t.KVDataList[0].value);return e.score=a,t.score=n,n-a})},getSelfData:function(e){for(var t=0;t<e.length;t++)if(e[t].avatarUrl==Subdomain.UserData.avatarUrl)return e[t];return null}}),cc._RF.pop()},{}],GlobalVar:[function(e,t,a){"use strict";cc._RF.push(t,"eab62DF6W1Kro/KJ020RJdC","GlobalVar"),window.Subdomain=window.Subdomain||{},window.Subdomain.GlobalVar={groupShareTicket:null},cc._RF.pop()},{}],GroupRankList:[function(e,t,a){"use strict";cc._RF.push(t,"bc4bc1khRpOPrXOlypTvH8p","GroupRankList"),cc.Class({extends:cc.Component,properties:{rankingScrollView:cc.ScrollView,scrollViewContent:cc.Node,prefabRankItem:cc.Prefab},onLoad:function(){cc.director.getWinSize().height/cc.director.getWinSize().width-16/9>.1&&(this.node.scaleY=cc.director.getWinSize().height/1334)},show:function(){this.removeChild(),this.showRankList()},clear:function(){this.removeChild()},removeChild:function(){this.node.removeChildByTag(1e3),this.scrollViewContent.removeAllChildren(),this.rankingScrollView.node.active=!1},showRankList:function(){var e=this;Subdomain.WXHelper.GetGroupCloudData(["highest_score"],function(t){if(t&&t.data){console.log("\u83b7\u53d6\u7fa4\u540c\u73a9\u7528\u6237\u7684\u6258\u7ba1\u6570\u636e:",t),e.dataSort(t.data);for(var a=0;a<t.data.length;a++){var n=cc.instantiate(e.prefabRankItem,a);if(n.parent=e.scrollViewContent,n.getComponent("RankItem").initView(a+1,t.data[a]),n.y=-100*a,t.data[a].avatarUrl==Subdomain.UserData.avatarUrl){var i=cc.instantiate(e.prefabRankItem,a);i.parent=e.node,i.getComponent("RankItem").initView(a+1,t.data[a],!0),i.y=-190}}e.rankingScrollView.node.active=!0}})},dataSort:function(e){for(var t=0;t<e.length;t++){var a=e[t];a&&a.KVDataList.length<=0&&a.KVDataList.push({key:"highest_score",value:t})}e.sort(function(e,t){var a=parseInt(e.KVDataList[0].value),n=parseInt(t.KVDataList[0].value);return e.score=a,t.score=n,n-a})}}),cc._RF.pop()},{}],JJCYScene:[function(e,t,a){"use strict";cc._RF.push(t,"d69f6c6t7lHibXDdG6C9vk9","JJCYScene"),cc.Class({extends:cc.Component,properties:{jjcybg:cc.Node,jjcyheadImg:cc.Sprite,jjcyname:cc.Label,jjcyvalue:cc.Label},friendData:null,onLoad:function(){},show:function(e){var t=this;t.friendData?t.refresh(e):t.getSortFriendData(function(a){t.refresh(e)})},refresh:function(e){if(this.friendData){var t=this.findData(e);t?this.initView(t):this.clear()}},getSortFriendData:function(e){var t=this;Subdomain.WXHelper.GetFriendCloudData(["highest_score"],function(a){t.friendData=a.data,t.dataSort(t.friendData,!0),e(a)})},findData:function(e){if(!this.friendData||this.friendData.length<=0)return null;for(var t=0;t<this.friendData.length;t++){var a=this.friendData[t],n=a.KVDataList[0].value;if(Subdomain.UserData.avatarUrl!=a.avatarUrl&&n>e)return this.friendData.splice(0,t),a}return null},dataSort:function(e,t){e&&e.sort(function(e,a){var n=parseInt(e.KVDataList[0].value),i=parseInt(a.KVDataList[0].value);return e.score=n,a.score=i,t?n-i:i-n})},initView:function(e){e?(Subdomain.Common.CreateImage(this.jjcyheadImg,e.avatarUrl),Subdomain.Common.SetNodeText(this.jjcyvalue,e.KVDataList[0].value),this.jjcybg.active=!0):this.jjcybg.active=!1},clear:function(){this.jjcybg.active=!1,this.friendData&&(this.friendData.length=0,this.friendData=null)}}),cc._RF.pop()},{}],MainScene:[function(e,t,a){"use strict";cc._RF.push(t,"2e80bxUIJtFs6aXIfrGh/FV","MainScene"),cc.Class({extends:cc.Component,properties:{jjcyPlayer:cc.Node,groupRankList:cc.Node,friendRankList:cc.Node},onLoad:function(){var e=cc.view;cc.view._convertPointWithScale=function(t){var a=e._viewPortRect;t.x=(t.x-a.x)/(e._scaleX/2),t.y=(t.y-a.y)/(e._scaleY/2)},cc.view._convertTouchesWithScale=function(t){for(var a,n,i,r=e._viewPortRect,o=e._scaleX/2,c=e._scaleY/2,s=0;s<t.length;s++)n=(a=t[s])._point,i=a._prevPoint,n.x=(n.x-r.x)/o,n.y=(n.y-r.y)/c,i.x=(i.x-r.x)/o,i.y=(i.y-r.y)/c}},start:function(){var e=this;cc.log("\u5b50\u57df\u573a\u666f\u8fd0\u884c"),this.hideAllLayer(),window.wx.onMessage(function(t){cc.log("\u63a5\u6536\u4e3b\u57df\u53d1\u6765\u6d88\u606f\uff1a",t),t.messageType==Subdomain.MessagetType.MT_FriendRankList?e.showFetchFriendRankList():t.messageType==Subdomain.MessagetType.MT_OverRankList?e.showGameOverRankList():t.messageType==Subdomain.MessagetType.MT_JJCYPlayer?e.showJJCYPlayer(t.curScore):t.messageType==Subdomain.MessagetType.MT_GroupRankList?(Subdomain.GlobalVar.groupShareTicket=t.groupShareTicket,e.showGroupRankList()):t.messageType==Subdomain.MessagetType.MT_UpdateJJCYPlayer?e.refreshJJCYPlayer(t.curScore):t.messageType==Subdomain.MessagetType.MT_FriendRankList&&e.clear()});Subdomain.WXHelper.GetUseInfo(function(e){cc.log("\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u6210\u529f---\x3e>>",e),Subdomain.UserData=e.data[0]})},showFetchFriendRankList:function(){this.hideAllLayer();var e=this.friendRankList.getComponent("FriendRankList");e&&e.show(),this.friendRankList.active=!0},showGameOverRankList:function(){},showJJCYPlayer:function(e){this.hideAllLayer();var t=this.jjcyPlayer.getComponent("JJCYScene");t&&t.show(e),this.jjcyPlayer.active=!0},refreshJJCYPlayer:function(e){var t=this.jjcyPlayer.getComponent("JJCYScene");t&&t.show(e),this.jjcyPlayer.active=!0},showGroupRankList:function(){this.hideAllLayer();var e=this.groupRankList.getComponent("GroupRankList");e&&e.show(),this.groupRankList.active=!0},hideAllLayer:function(){this.jjcyPlayer&&(this.jjcyPlayer.active=!1),this.groupRankList&&(this.groupRankList.active=!1),this.friendRankList&&(this.friendRankList.active=!1)},clear:function(){var e=this.groupRankList.getComponent("GroupRankList");e&&e.clear();var t=this.jjcyPlayer.getComponent("JJCYScene");t&&t.clear()}}),cc._RF.pop()},{}],MessageType:[function(e,t,a){"use strict";cc._RF.push(t,"640f56gNSJAYY+Y2X5qtuGI","MessageType"),window.Subdomain=window.Subdomain||{},Subdomain.MessagetType=cc.Enum({MT_FriendRankList:1,MT_OverRankList:2,MT_JJCYPlayer:3,MT_GroupRankList:4,MT_UpdateJJCYPlayer:5,MT_Clear:6}),cc._RF.pop()},{}],RankItem:[function(e,t,a){"use strict";cc._RF.push(t,"3ca90WQYmlN/rZa9aXTzoZa","RankItem"),cc.Class({extends:cc.Component,properties:{bgImg:cc.Node,rankImg:cc.Node,rankNum:cc.Node,headImg:cc.Node,playerName:cc.Node,score:cc.Node,bwSprite:cc.Node},start:function(){},initView:function(e,t,a,n){var i=this;e<=3?(i.rankImg.active=!0,i.rankNum.active=!1,i.bwSprite.active=!1,cc.loader.load({url:cc.url.raw("resources/rank"+e+".png"),type:"png"},function(e,t){i.rankImg.getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(t)})):a&&n?(i.bwSprite.active=!0,i.rankNum.active=!1,i.rankImg.active=!1):(i.rankNum.active=!0,i.rankImg.active=!1,i.bwSprite.active=!1,Subdomain.Common.SetNodeText(i.rankNum,e));var r=null;e%2==0&&(r="resources/fankFrame2.png"),a&&(r="resources/meFrame.png"),r&&cc.loader.load({url:cc.url.raw(r),type:"png"},function(e,t){i.bgImg.getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(t)});var o=Subdomain.Common.GetByteVal(t.nickname,10);Subdomain.Common.CreateImage(i.headImg,t.avatarUrl),Subdomain.Common.SetNodeText(i.playerName,o),Subdomain.Common.SetNodeText(i.score,t.KVDataList[0].value)}}),cc._RF.pop()},{}],WXHelper:[function(e,t,a){"use strict";cc._RF.push(t,"c16daEJ7edMe5u65Jaezrr7","WXHelper"),window.Subdomain=window.Subdomain||{},window.Subdomain.WXHelper={IsWXContext:function(){return void 0!=window.wx},GetUseInfo:function(e){wx.getUserInfo({withCredentials:!1,openIdList:["selfOpenId"],lang:"zh_CN",success:e,fail:function(e){cc.log("\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5931\u8d25:",e)}})},GetGroupCloudData:function(e,t){console.log("shareTicket:",Subdomain.GlobalVar.groupShareTicket),wx.getGroupCloudStorage({shareTicket:Subdomain.GlobalVar.groupShareTicket,keyList:["highest_score"],success:t,fail:function(e){console.log("Rank:\u83b7\u53d6\u7fa4\u7684\u4fe1\u606f\u5931\u8d25:",e)}})},GetFriendCloudData:function(e,t){wx.getFriendCloudStorage({keyList:["highest_score"],success:function(e){console.log("wx.getFriendCloudStorage success",e),t(e)},fail:function(e){console.log("wx.getFriendCloudStorage fail",e)}})}},cc._RF.pop()},{}]},{},["Common","FriendRankList","GlobalVar","GroupRankList","JJCYScene","MainScene","MessageType","RankItem","WXHelper"]);